<template>
  <style>
    m-name {
      color: orange;
    }
    m-tweets {
      overflow-x: hidden;
      overflow-y: scroll;
    }
  </style>

  <m-name></m-name>
  <m-tweets></m-tweets>
</template>

<script type="text/javascript">
  (function () {
    "use strict";

    var template = document.currentScript.ownerDocument.querySelector('template');

    class Channel extends HTMLElement {
      createdCallback() {
        this.createShadowRoot().appendChild(document.importNode(template.content, true));
        this.config = null;
        this.data = null;
        this.nameElem = this.shadowRoot.querySelector('m-name');
        this.tweetsElem = this.shadowRoot.querySelector('m-tweets');
      }

      setName(name) {
        this.nameElem.textContent = name;
        return this;
      }

      setData(config, data) {
        this.config = config;
        this.data = data;

        // set name
        this.setName(this.config.name);

        // Remove all children
        $.removeAllChild(this.tweetsElem);

        // update new data
        // flatten [[tweetsForSource1], [tweetsForSource2], ...]
        data.reduce((all, current) => { return all.concat(current); }, [])
          .forEach(function(tweet) {
            this.tweetsElem.appendChild(document.createElement('x-tweet').setData(tweet));
          }, this);

        return this;
      }
    }

    document.registerElement("x-channel", Channel);
  })();
</script>
