// it need duplicated in index.html and here?
<script src="/vendor/jsoneditor.min.js"></script>
<script src="/vendor/ace.js"></script>

<template>
  <style>
    @import "/vendor/jsoneditor.min.css";
    .editor {
      width: 400px;
      height: 400px;
    }
  </style>

  <div class="editor"></div>
  <button type="button" name="save">Save</button>
  <button type="button" name="reset">Reset to default</button>
</template>

<script type="text/javascript">
  (function () {
    "use strict";

    var template = document.currentScript.ownerDocument.querySelector('template');

    var defaultConfig = {
      boards: [
        {
          name: 'board1',
          channels: [
            {
              name: 'Home',
              sources: ['statuses_homeTimeline']
            },
            {
              name: 'Mentions',
              sources: ['statuses_mentionsTimeline']
            },
            {
              name: 'Mix sources',
              sources: ['statuses_homeTimeline', 'statuses_mentionsTimeline']
            }
          ]
        }
      ]
    };

    class Config extends HTMLElement {
      createdCallback() {
        this.createShadowRoot().appendChild(document.importNode(template.content, true));
        this.saveButton = this.shadowRoot.querySelector('button[name=save]');
        this.resetButton = this.shadowRoot.querySelector('button[name=reset]');
        this.editorElem = this.shadowRoot.querySelector('.editor');

        this.saveButton.addEventListener('click', this.saveConfig.bind(this));
        this.resetButton.addEventListener('click', this.resetConfig.bind(this));

        this.editor = new JSONEditor(this.editorElem, {mode: 'code'});
        this.loadConfig();
      }

      loadConfig() {
        document.config = JSON.parse(localStorage.getItem('config'));
        this.editor.set(document.config);
        console.log("Config loaded:", document.config);
      }

      saveConfig() {
        document.config = this.editor.get();
        localStorage.setItem('config', JSON.stringify(document.config));
        console.log("Config saved.", JSON.stringify(document.config));
      }

      resetConfig() {
        this.editor.set(defaultConfig);
        this.saveConfig();
      }
    }

    document.registerElement("x-config", Config);
  })();
</script>
