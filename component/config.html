<!-- it need duplicated in index.html and here? -->
<script src="../vendor/jsoneditor@4.2.1/jsoneditor.min.js"></script>

<template>
  <style>
    /* Relative to the url, which is the directory of index.html */
    @import "vendor/jsoneditor@4.2.1/jsoneditor.min.css";
    .editor {
      width: 400px;
      height: 400px;
    }
  </style>

  <div class="editor"></div>
  <button type="button" name="save">Save</button>
  <button type="button" name="reset">Reset to default</button>
</template>

<script type="text/javascript">
  (function() {
    "use strict";

    var template = document.currentScript.ownerDocument.querySelector('template');

    var defaultConfig = {
      channels: [{
        name: 'Home',
        sources: ['statuses_homeTimeline']
      }, {
        name: 'Mentions',
        sources: ['statuses_mentionsTimeline']
      }, {
        name: 'Mix sources',
        sources: ['statuses_homeTimeline', 'statuses_mentionsTimeline']
      }]
    };

    class Config extends HTMLElement {
      createdCallback() {
        this.createShadowRoot().appendChild(document.importNode(template.content, true));
        this.saveButton = this.shadowRoot.querySelector('button[name=save]');
        this.resetButton = this.shadowRoot.querySelector('button[name=reset]');
        this.editorElem = this.shadowRoot.querySelector('.editor');

        this.saveButton.handle('click', this.saveConfig.bind(this));
        this.resetButton.handle('click', this.resetConfig.bind(this));

        this.editor = new JSONEditor(this.editorElem, {
          mode: 'code'
        });
        this.loadConfig();
      }

      loadConfig() {
        var config = document.store.getConfig(document.account);
        this.editor.set(config);
        console.log("Config loaded:", config);
      }

      saveConfig() {
        var config = this.editor.get();
        document.store.saveConfig(document.account, config);
        console.log("Config saved.", JSON.stringify(config));
        this.trigger('switchBoard', document.account);
      }

      resetConfig() {
        this.editor.set(defaultConfig);
        document.store.saveConfig(document.account, defaultConfig);
        console.log("Config reseted.");
      }
    }

    document.registerElement("x-config", Config);
  })();
</script>
