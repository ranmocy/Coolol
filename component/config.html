<!-- it need duplicated in index.html and here? -->
<script src="../vendor/jsoneditor@4.2.1/jsoneditor.min.js"></script>

<template>
  <style>
    /* Relative to the url, which is the directory of index.html */
    @import "../vendor/jsoneditor@4.2.1/jsoneditor.min.css";
    #editor {
      width: 400px;
      height: 400px;
    }
  </style>

  <div id="editor"></div>

  <button type="button" id="save">Save</button>
  <button type="button" id="reset">Reset to default</button>
</template>

<script type="text/javascript">
  (function() {
    "use strict";

    var template = document.currentScript.ownerDocument.querySelector('template');

    class Config extends XElement {
      createdCallback() {
        this.createShadowRoot().appendChild(document.importNode(template.content, true));

        this.$('#save').handle('click', this.saveConfig.bind(this));
        this.$('#reset').handle('click', this.resetConfig.bind(this));

        this.editor = new JSONEditor(this.$('#editor'), {
          mode: 'code'
        });
        this.loadConfig();
      }

      loadConfig() {
        var config = document.store.getConfig(document.account);
        this.editor.set(config);
        console.log("Config loaded:", config);
      }

      saveConfig() {
        var config = this.editor.get();
        document.store.saveConfig(document.account, config);
        console.log("Config saved.", JSON.stringify(config));
        this.trigger('switchView', 'board', document.account);
      }

      resetConfig() {
        var config = document.store.resetConfig(document.account);
        this.editor.set(config);
        console.log("Config reseted.");
      }
    }

    document.registerElement("x-config", Config);
  })();
</script>
