<template id="tweet-control">
  <style type="text/css">
    @import "../vendor/font-awesome-4.4.0/css/font-awesome.min.css";
    :host {
      position: absolute;
      right: 1em;
    }
    i {
      display: inline-block;
      cursor: pointer;
    }
    i[data-status='disabled'] {
      cursor: normal;
      color: #eee;
    }
    i[data-status='retweeted'] {
      color: #5c913b;
    }
    i[data-status='favorited'] {
      color: #dd2e44;
    }
  </style>

  <i id="reply-button" class="fa fa-reply"></i>
  <i id="retweet-button" class="fa fa-retweet"></i>
  <i id="fav-button" class="fa fa-heart"></i>
</template>

<script type="text/javascript">
  (function() {
    "use strict";

    var $$$template = document.currentScript.ownerDocument.querySelector('template#tweet-control').content;

    class TweetControl extends XElement {
      createdCallback() {
        this.createShadowRoot().appendChild(document.importNode($$$template, true));

        this.$('#reply-button').handle('click', () => {
          this.trigger('openComposeForReply', this.tweet);
        });
        this.$('#retweet-button').handle('click', this.retweet.bind(this));
        this.$('#fav-button').handle('click', this.favorite.bind(this));

        this.tweet = null;

        this.hide();
      }

      setTweet(tweet) {
        this.tweet = tweet;
        if (this.tweet.user.screen_name === document.account.screen_name) {
          this.$('#retweet-button').dataset.status = 'disabled';
        } else if (this.tweet.retweeted) {
          this.$('#retweet-button').dataset.status = "retweeted";
        }

        if (this.tweet.favorited) {
          this.$('#fav-button').dataset.status = 'favorited';
        }
      }

      retweet() {
        if (this.tweet.user.screen_name !== document.account.screen_name) {
          this.trigger('openComposeForRetweet', this.tweet);
        }
      }

      favorite() {
        document.store.getTwitterClient(document.account)
          .post("favorites_create", {
            id: this.tweet.id_str
          })
          .then((reply) => {
            console.log('[tweet] favorite:', reply);
          }).catch((err) => {
            console.error('[tweet] favorite failed:', err);
          });
      }
    }

    document.registerElement("x-tweet-control", TweetControl);
  })();
</script>
